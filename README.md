# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/types — объявление типов, используемых в проекте
- src/types/components — объявление типов компонентов, используемых в проекте
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
- src/types/settings.ts - файл с определением типов настроек приложения

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание проекта

Проект "Web-ларёк" реализует базовый функционал типового интернет-магазина, в данном случае с товарами для разработчиков. Пользователь может просматривать каталог товаров, информацию о конкретном товаре, добавлять товары в корзину и оформить заказ. 


Для получения данных о товарах в магазине используется подключения по  API.

## Описание интерфейса

Интерфейс проекта:

- Просмотр каталога товаров
- Просмотр карточки товара
- Просмотр корзиры
- Оформление заказа

## Архитектрура проекта

Приложение построено по архитектуре **MVP (Model-View-Presenter)** и использует **TypeScript** для строгой типизации данных.

Для реализации связи между Model и View используется паттерн **брокер событий** реализованный через класс `AppStateEmitter`.

- **Model**:
  - Отвечает за управление данными и бизнес-логикой приложения.
  - Включает определение типов данных приложения:`Product`, `ProductCatalog`, `Order`.
  - Взаимодействует с API через класс `LarekAPI` для получения и обновления данных о товарах.
  - Определяет состояние приложения через интерфейс `IAppState`, который сохраняет информацию о каталоге товаров, текущем состоянии корзины покупателя, а также текущем состоянии приложения и данные, необходимых для оформления заказа.
  - Использует `AppStateEmitter` для оповещения об изменениях в данных.

- **View**:
  - Не содержит бизнес-логики и отвечает за отображение пользовательского интерфейса.
  - Включает компоненты для отображения каталога товаров, информации о товаре, содержимого корзины и форм оформления заказа.
  - Реализована в трех типах:
    - `common`: общие компоненты, не зависящие о доменной области проекта.
    - `partial`: компоненты, реализующие доменную область приложенния.
    - `screen`: верхнеуровневые компоненты, которые являются экранными элементами.
 
- **Presetner**:
  - Обеспечивает взаимодействие между `Model` и `View`.
  - Реализует логику обработки пользовательских запросов, таких как добавление и удаление товаров из корзину, и оформление заказа.
  - Устанавливает слушателей для событий модели, чтобы своевременно обновлять `View` в ответ на изменения.
  - Не выделен в отдельный класс, а реализован в основном скрипте приложения.

## Описание внутренних типов, используемых в приложении

### Тип `ApiListResponse<Type>`
- **Описание**: Универсальный тип для ответа API, содержащий общее количество элементов (`total`) и массив элементов (`items`).

### Enum `TPaymentType`
- **Описание**: Определяет типы доступных способов оплаты.
- **Значения**:
  - `card`: Оплата картой онлайн.
  - `cash`: Оплата при получении.

### Тип `TContacts`
- **Описание**: Контактная информация покупателя.
- **Поля**:
  - `email: string`: Электронная почта.
  - `phoneNumber: string`: Номер телефона.

### Тип `TPaymentAddress`
- **Описание**: Содержит информацию о типе оплаты и адресе доставки.
- **Поля**:
  - `payment: TPaymentType`: Тип оплаты.
  - `address: string`: Адрес доставки.
  
## Описание базовых классов

### Класс `Component`

Абстрактный класс `Component` описывает базовые интерфейсы для работы с DOM-элементами и отображением данных. Он используется в качестве родительского класса для других компонентов, чтобы обеспечивать единый способ отображения данных и их обновления.

- **Атрибуты**:
- `element: HTMLElement`: Корневой элемент DOM, с которым работает этот вид. Используется для вставки, обновления и удаления содержимого представления.

- **Методы**:
  - `toggleClass(element: HTMLElement, className: string, force?: boolean)`: Переключает класс у элемента
  - `protected setText(element: HTMLElement, value: unknown)`: Устанавливает текстовое содержимое
  - `protected setImage(element: HTMLImageElement, src: string, alt?: string)`: Устанавливает изображение с альтернативным текстом
  - `setDisabled(element: HTMLElement, state: boolean)`: Меняет статус блокировки
  - `protected setHidden(element: HTMLElement) `: Скрывает элемент
  - `protected setVisible(element: HTMLElement)`: Показывает элемент
  - `render(data?: Partial<T>): HTMLElement`: Отображает данные в DOM-элементе `element`. Принимает объект `data` типа `Partial<T>` и возвращает обновленный элемент `HTMLElement` после рендеринга.

### Класс `Api`

`Api` — базовый класс для взаимодействия с RESTful API. Он поддерживает выполнение GET и POST запросов, обработку ответов и настройку заголовков.

- **Атрибуты**:
  - `baseUrl: string`: Базовый URL для API-запросов.
  - `_options: RequestInit`: Опции для настройки запросов, включая заголовки.

- **Конструктор**:
  - `constructor(baseUrl: string, options: RequestInit = {})`: Инициализирует `Api` с базовым URL и настройками, включая заголовок `Content-Type: application/json`.

- **Методы**:
  - `_handleResponse<T>(response: Response): Promise<T>`: Обрабатывает ответ от сервера, возвращает JSON или ошибку.
  - `_get<T>(uri: string): Promise<T>`: Выполняет GET-запрос по заданному URI.
  - `_post<T>(uri: string, data: object): Promise<T>`: Выполняет POST-запрос с передачей данных.

### Класс `EventEmitter`

`EventEmitter` — класс для управления подпиской на события, их вызовом и отменой. Он используется для организации асинхронного взаимодействия между компонентами через события.

- **Атрибуты**:
  - `events: EventsMap`: Коллекция событий и связанных с ними обработчиков.

- **Конструктор**:
  - `constructor()`: Инициализирует `EventEmitter` с пустой коллекцией событий.

- **Методы**:
  - `on(eventName: string, handler: EventHandler)`: Регистрирует обработчик события для указанного имени события.
  - `off(eventName: string, handler: EventHandler)`: Удаляет обработчик для указанного имени события.
  - `emit(eventName: string, data: object)`: Вызывает все обработчики, связанные с указанным именем события, передавая им данные.
  - `reset()`: Очищает все зарегистрированные события и обработчики.
  - `bindEmitter(events: EventsMap)`: Заменяет текущую коллекцию событий на указанную.

## Описание классов модели

### Класс `LarekAPI`
- Предоставляет интерфейсы для взаимодействия с API онлайн-магазина.
- **Методы**:
  - `getProducts(): Promise<IProductCatalog>`: Получает каталог товаров магазина через вызов API `GET {{baseUrl}}/product`
  - `getProductDetails(id: string): Promise<IProduct>`: Получает подробную информацию о товаре через вызов `GET {{baseUrl}}/product/<id>`
  - `createOrder(order: IOrder): Promise<IOrderResult>`: Перелавет данные заказа и возвращает результат создания заказа через вызов API `POST {{baseUrl}}/order`.

### Класс `AppState`
- Описывает состояние приложения.
- **Атрибуты**:
  - `products: IProductCatalog`: Каталог товаров, загруженный с сервера.
  - `userOrder: IOrder`: Корзина и данные заказа покупателя.
  - `isOrderReady(): boolean`: Проверяет, что заказ корректно сформирован.
  - `openedModal: AppStateModals`: Текущее открытое модальное окно.
- **Методы**:
  - `setProductCatalog(products: IProductCatalog): void`: Сохраняет данные каталога товаров в модели и уведомляет об изменении.
  - `selectProduct(id: string | null): void`: Изменяет в модели текущий выбранный продукт из каталога и уведомляет об изменении.
  - `addToBasket(id: string): void`: Добавляет товар к заказу по `id`.
  - `removeFromBasket(id: string): void`: Удаляет товар из заказа по `id`.
  - `getBasketTotal(): number`: Возвращает общую сумму товаров в корзине.
  - `getBasketItems(): IProduct[]`: Возвращает список товаров в корзине.
  - `fillAddress(address: TPaymentAddress): void`: Добавляет в заказ данные по способу оплаты и адресу доставки.
  - `fillContacts(contats: TContacts): void`: Добавляет в заказ контактные данные покупателя.
  - `getOrder(): IOrder`: Возвращает данные заказа покупателя.
  - `clearOrder(): void`: Сбрасывает данные заказа покупателя. Необходимо после успешной отправки заказа.
  - `setOrderResult(result: IOrderResult): void`: Сохраняет данные об успешно отправленном заказе в модели.
  - `clearOrderResult(): void`: Сбрасывает данные об успешно отправленном заказе. Необходимо после завершения цикла заказа.
  - `openModal(modal: AppStateModals): void`: Сохраняет текущее открытое модельное окно и уведомляет об изменении.
  - `formatCurrency(value: number): string`: Конвертирует цену/сумму в строковое представление с учетом валюты.

### Класс `AppStateEmitter`
- Расниряет `EventEmitter`
- **Атрибуты**:
  - `model: IAppState`: Представляет доступ к модели приложения.
  - `previousModal: AppStateModals`: Сохраняет инфомацию о предыдущем модальном окне.

## Описание событийной модели

### Enum `AppStateModals`
- Определяет возможные состояния модальных окон приложения.
- **Значения**:
  - `none`: Модальное окно закрыто.
  - `product`: Модальное окно с информацией о товаре.
  - `basket`: Модальное окно корзины.
  - `order`: Модальное окно для ввода адреса доставки.
  - `contacts`: Модальное окно для ввода контактной информации.
  - `success`: Модальное окно успешного завершения заказа.

### Enum `AppStateChanges`
  - Определяет типы изменений, которые могут происходить в состоянии приложения.
  - **Значения**:
    - `catalog`: Изменение выбранного продукта.
    - `modal`: Изменение состояния модальных окон.
    - `product`: Изменение выбранного продукта из каталога.
    - `addProduct`: Добавление продукта в заказ.
    - `removeProduct`: Удаление продукта из заказа.
    - `basket`: Изменение состояния корзины.
    - `order`: Изменение данных об оплате и адреса доставки.
    - `contacts`: Изменение контактных данных.
    - `submit`: Отправка заказа через API.
    - `success`: Заказ успешно размещен.

## Описание классов отображения

Классы отображения обеспечавают представление данных в элементах интерфейс приложения. Каждый класс отображения приложения наследуется базового класса `View`.:

### Common

Описывает общие классы, не зависящие от доменной области приложения

### Класс `Form`
- Управляет состоянием и поведением формы для ввода пользовательских данных. Он позволяет обрабатывать изменения, управлять доступностью формы и отображать сообщения пользователю.
- **Атрибуты**:
  - `_submit: HTMLButtonElement`: Элемент кнопки для отправки формы.
  - `_errors: HTMLElement`: Элемент отображения ошибки формы.
- **Методы**:
  - `set valid(value: boolean)`: Получает через API каталог товаров и уведомляет об изменении.
  - `set errors(value: string)`: Устанавливает сообщение об ошибке.
  - `render(state: Partial<T> & IFormState): HTMLFormElement`: Обновляет элемент формы на основе заданного состояния и объектов `inputs`. 

### Класс `Modal`
- Управляет отображением и поведением модального окна.
- **Атрибуты**:
  - `_closeButton: HTMLButtonElement`: Элемент кнопки для закрытия модельного окна.
  - `_content: HTMLElement`: Элемент отображения содержимого модельного окна.
  - `_settings: IModalSettings`: Сохраняет настройки для отображения модального окна.
- **Методы**:
  - `set content(value: HTMLElement)`: Устанавливает дочерний элемент содержимого модального окна.
  - `open()`: Открывает модельное окно.
  - `close()`: Удаеляет содержимое и закрывает модальное окно.
  - `render(data: IModalData): HTMLElement`: Обновляет элемент модельного окна. 

### Partial

### Класс `Page`
- Управляет отображением страницы и взаимодействием с основными компонентами, такими как корзиня и галерея. 

### Класс `Card`
- Управляет отображением карточкек в галереи товаров, корзине пользователя и в превью. 

### Screen

### Класс `Basket`
- Управляет отображением и взаимодействием с экраном корзины, на котором отображаются выбранные пользователем товары и их общая стоимость. Он предоставляет возможности для удаления товаров из корзины, перехода к следующему шагу оформления заказа и закрытия корзины.
- **Атрибуты**:
  - `items: HTMLElement[]`: Список элементы в корзине
  - `total: string`: Сообщение об общей сумме заказа.

### Класс `Order`
- Управляет отображением и взаимодействием с экраном заказа для выбора способа оплаты и адрес доставки.
- **Атрибуты**:
  - `address: string`:  Введенный адрес пользователя.
  - `payment: TPaymentType`: Выбранный способ оплаты.
- **Методы**:
  - `validate()`: Валидация формы.

### Класс `Contacts`
- Управляет отображением и взаимодействием с экраном контактной информации пользователя для указания электронной почты и номера телефона.
- **Атрибуты**:
  - `email: string`: Введенный email пользователя.
  - `phone: string`: Введенный номер телефона пользователя.
- **Методы**:
  - `validate()`: Валидация формы.

### Класс `Success`
- Управляет отображением сообщения об успешном завершении оформления заказа. Он позволяет отобразить текст сообщения и управлять видимостью экрана, а также предоставляет возможность закрытия экрана.
- **Атрибуты**:
  - `message:  string`: Сообщение о сумме списания.